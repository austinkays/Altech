<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            width: 360px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            font-size: 13px;
        }

        /* ‚îÄ‚îÄ Dark Mode ‚îÄ‚îÄ */
        body.dark {
            background: #1c1c1e;
            color: #f2f2f7;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a2140, #2a3a6a);
            color: #fff;
            padding: 14px 16px;
            display: flex; align-items: center; gap: 10px;
        }
        .header-icon { font-size: 20px; }
        .header-title { font-weight: 700; font-size: 15px; }
        .header-version { font-size: 10px; opacity: 0.5; margin-left: auto; }

        /* Theme toggle button */
        .theme-toggle {
            background: transparent; border: none; cursor: pointer;
            font-size: 14px; opacity: 0.7; padding: 2px 4px;
            border-radius: 4px; transition: opacity 0.15s;
        }
        .theme-toggle:hover { opacity: 1; }

        /* Content */
        .content { padding: 12px; }

        /* Client Card */
        .client-card {
            background: #fff;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid #e5e5ea;
        }
        body.dark .client-card {
            background: #2c2c2e;
            border-color: #38383a;
        }
        .client-label {
            font-size: 10px;
            font-weight: 600;
            color: #8e8e93;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .client-name {
            font-size: 16px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 6px;
        }
        body.dark .client-name { color: #f2f2f7; }
        .client-name.empty { color: #8e8e93; font-weight: 400; font-style: italic; }
        .client-fields {
            display: flex; gap: 12px; flex-wrap: wrap;
        }
        .client-stat {
            font-size: 11px; color: #6c757d;
        }
        .client-stat strong {
            color: #1d1d1f; font-weight: 600;
        }
        body.dark .client-stat strong { color: #f2f2f7; }

        /* Page Info */
        .page-card {
            background: #fff;
            border-radius: 12px;
            padding: 10px 14px;
            margin-bottom: 10px;
            border: 1px solid #e5e5ea;
            display: flex; align-items: center; gap: 8px;
        }
        body.dark .page-card {
            background: #2c2c2e;
            border-color: #38383a;
        }
        .page-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: #ff3b30; flex-shrink: 0;
        }
        .page-dot.connected { background: #34c759; }
        .page-label { font-size: 12px; color: #6c757d; }
        .page-label strong { color: #1d1d1f; }
        body.dark .page-label strong { color: #f2f2f7; }

        /* Buttons */
        .actions { display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
        .btn {
            display: flex; align-items: center; justify-content: center; gap: 6px;
            padding: 10px 14px;
            border: none; border-radius: 10px;
            font-size: 13px; font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn:hover { filter: brightness(0.95); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

        .btn-paste {
            background: #007AFF; color: #fff;
        }
        .btn-fill {
            background: #34c759; color: #fff;
        }
        .btn-row { display: flex; gap: 8px; }
        .btn-row .btn { flex: 1; }
        .btn-clear {
            background: #f2f2f7; color: #ff3b30;
        }
        body.dark .btn-clear {
            background: #3a3a3c; color: #ff453a;
        }
        .btn-refill {
            background: #f2f2f7; color: #007AFF;
        }
        body.dark .btn-refill {
            background: #3a3a3c; color: #0a84ff;
        }
        .btn-scrape {
            background: #5856d6; color: #fff;
        }
        .btn-property {
            background: #ff9500; color: #fff;
        }
        .btn-copy-prop {
            background: #34c759; color: #fff;
        }
        .btn-export {
            background: #f2f2f7; color: #5856d6; font-size: 11px;
        }
        body.dark .btn-export {
            background: #3a3a3c; color: #5e5ce6;
        }

        /* Admin section */
        .admin-zone { display: none; }
        .admin-zone.visible { display: block; }
        .admin-toggle {
            display: none; align-items: center; justify-content: center;
            gap: 6px; padding: 6px;
            font-size: 10px; color: #8e8e93;
            cursor: pointer; user-select: none;
            border-top: 1px solid #e5e5ea;
            margin-top: 4px;
        }
        body.dark .admin-toggle { border-top-color: #38383a; }
        .admin-toggle.visible {
            display: flex;
        }
        .admin-toggle:hover { color: #007AFF; }
        .admin-badge {
            font-size: 9px; font-weight: 700; text-transform: uppercase;
            padding: 2px 6px; border-radius: 4px;
            background: rgba(88, 86, 214, 0.12); color: #5856d6;
            letter-spacing: 0.3px;
        }

        /* Schema Stats */
        .schema-stats {
            background: #fff;
            border-radius: 10px;
            padding: 10px 14px;
            margin-bottom: 10px;
            border: 1px solid #e5e5ea;
            font-size: 11px;
            color: #8e8e93;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        body.dark .schema-stats {
            background: #2c2c2e;
            border-color: #38383a;
        }
        .schema-stats strong { color: #1d1d1f; }
        body.dark .schema-stats strong { color: #f2f2f7; }
        .schema-stats .schema-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: #34c759; flex-shrink: 0;
        }

        /* Property Results */
        .prop-results {
            background: #fff;
            border-radius: 12px;
            padding: 10px 14px;
            margin-bottom: 10px;
            border: 1px solid #e5e5ea;
            max-height: 240px;
            overflow-y: auto;
        }
        body.dark .prop-results {
            background: #2c2c2e;
            border-color: #38383a;
        }
        .prop-results .prop-header {
            display: flex; align-items: center; gap: 6px;
            margin-bottom: 8px;
        }
        .prop-results .prop-header .site-badge {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: 4px;
            background: #f2f2f7;
            color: #8e8e93;
        }
        .prop-results .prop-header .site-badge.zillow { background: #e8f5e9; color: #1b5e20; }
        .prop-results .prop-header .site-badge.redfin { background: #fce4ec; color: #b71c1c; }
        .prop-results .prop-header .site-badge.gis    { background: #e3f2fd; color: #0d47a1; }
        .prop-field {
            display: flex; justify-content: space-between; align-items: baseline;
            padding: 3px 0;
            font-size: 11px;
            border-bottom: 1px solid #f2f2f7;
        }
        body.dark .prop-field { border-bottom-color: #38383a; }
        .prop-field:last-child { border-bottom: none; }
        .prop-field .prop-label {
            color: #8e8e93; font-weight: 500; flex-shrink: 0;
            margin-right: 8px;
        }
        .prop-field .prop-value {
            color: #1d1d1f; font-weight: 600; text-align: right;
            word-break: break-word;
        }
        body.dark .prop-field .prop-value { color: #f2f2f7; }
        .prop-address {
            font-size: 13px; font-weight: 700; color: #1d1d1f;
            margin-bottom: 6px;
        }
        body.dark .prop-address { color: #f2f2f7; }

        /* Status */
        .status {
            background: #fff;
            border-radius: 12px;
            padding: 10px 14px;
            border: 1px solid #e5e5ea;
            font-size: 12px;
            color: #6c757d;
            min-height: 36px;
        }
        body.dark .status {
            background: #2c2c2e;
            border-color: #38383a;
            color: #98989d;
        }
        .status.success { border-color: rgba(52,199,89,0.3); background: rgba(52,199,89,0.06); color: #248a3d; }
        body.dark .status.success { color: #32d74b; background: rgba(52,199,89,0.08); }
        .status.error { border-color: rgba(255,59,48,0.3); background: rgba(255,59,48,0.06); color: #d70015; }
        body.dark .status.error { color: #ff453a; background: rgba(255,69,58,0.08); }

        /* Paste area */
        body.dark #pasteTextarea {
            background: #2c2c2e; color: #f2f2f7;
            border-color: #38383a !important;
        }
        body.dark #pasteTextarea::placeholder { color: #636366; }

        /* Footer */
        .footer {
            padding: 8px 16px;
            text-align: center;
            font-size: 10px;
            color: #8e8e93;
            border-top: 1px solid #e5e5ea;
        }
        body.dark .footer { border-top-color: #38383a; }
        .footer a {
            color: #007AFF; text-decoration: none;
        }
        body.dark .footer a { color: #0a84ff; }
    </style>
</head>
<body>
    <div class="header">
        <span class="header-icon">‚ö°</span>
        <span class="header-title">Altech EZLynx Filler</span>
        <span class="header-version" id="extVersion">v0.6.7</span>
        <button class="theme-toggle" id="themeToggle" title="Toggle dark/light mode">üåô</button>
    </div>

    <div class="content">
        <!-- Client Data Card -->
        <div class="client-card">
            <div class="client-label">Loaded Client</div>
            <div class="client-name empty" id="clientName">No client loaded</div>
            <div class="client-fields" id="clientFields"></div>
        </div>

        <!-- Page Detection Card -->
        <div class="page-card">
            <div class="page-dot" id="pageDot"></div>
            <div class="page-label" id="pageLabel">Checking page...</div>
        </div>

        <!-- Manual Paste Fallback -->
        <div class="paste-area" id="pasteArea" style="display:none;">
            <div class="client-label">Paste data here (Ctrl+V)</div>
            <textarea id="pasteTextarea" placeholder="Click here, then press Ctrl+V to paste the copied data from Altech..." rows="4" style="width:100%; border:1px solid #e5e5ea; border-radius:8px; padding:8px; font-size:11px; font-family:inherit; resize:vertical; margin:6px 0;"></textarea>
            <button class="btn btn-paste" id="manualPasteBtn" style="margin-bottom:8px;">üì• Load Pasted Data</button>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button class="btn btn-fill" id="fillBtn" disabled>‚ö° Fill This Page</button>
            <div class="btn-row">
                <button class="btn btn-refill" id="refillBtn" disabled>üîÑ Re-fill</button>
                <button class="btn btn-clear" id="clearBtn" disabled>üóë Clear</button>
            </div>
            <button class="btn btn-property" id="propertyBtn">üè† Grab Property Data</button>
            <button class="btn" id="pasteBtn" style="background:#f2f2f7; color:#007AFF; font-size:11px;">üìã Paste from Clipboard</button>
        </div>

        <!-- Admin Tools (auto-unlocked via isAdmin flag from Altech web app) -->
        <div class="admin-toggle" id="adminToggle">üîí Admin Tools</div>
        <div class="admin-zone" id="adminZone">
            <div class="actions">
                <button class="btn btn-scrape" id="scrapeBtn">üîç Scrape This Page <span class="admin-badge">Admin</span></button>
            </div>
            <!-- Schema Stats -->
            <div class="schema-stats" id="schemaStats">
                <span class="schema-dot"></span>
                <span id="schemaStatsText">Loading schema...</span>
                <button class="btn btn-export" id="exportSchemaBtn" style="margin-left:auto; padding:4px 10px;">üì§ Export</button>
            </div>
            <div style="font-size:10px; color:#8e8e93; padding:4px 8px; line-height:1.4;">
                üìã <strong>Workflow:</strong> Scrape pages ‚Üí Export ‚Üí commit <code>ezlynx_schema.json</code> to repo ‚Üí push ‚Üí team auto-syncs
            </div>
        </div>

        <!-- Property Results (hidden until scrape) -->
        <div id="propertyResults" style="display:none;">
            <div class="prop-results">
                <div class="prop-header">
                    <span style="font-weight:700; font-size:12px;">üè† Property Data</span>
                    <span class="site-badge" id="propSiteBadge">‚Äî</span>
                    <span style="margin-left:auto; font-size:10px; color:#8e8e93;" id="propFieldCount">0 fields</span>
                </div>
                <div class="prop-address" id="propAddress"></div>
                <div id="propFieldList"></div>
            </div>
            <div class="btn-row">
                <button class="btn btn-copy-prop" id="copyPropBtn">üìã Copy for Altech</button>
                <button class="btn btn-clear" id="clearPropBtn">üóë Clear</button>
            </div>
        </div>

        <!-- Status -->
        <div class="status" id="status">
            In Altech ‚Üí EZLynx Quoter ‚Üí click <strong>Send to Extension</strong>. Data loads automatically.
        </div>
    </div>

    <div class="footer">
        Data auto-syncs from Altech ¬∑ <a href="https://altech.agency" target="_blank">Open Altech</a>
    </div>

    <script src="defaultSchema.js"></script>
    <script src="popup.js"></script>
</body>
</html>
