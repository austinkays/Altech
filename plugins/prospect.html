<style>
    .ai-pulse { animation: aiPulse 2s ease-in-out infinite; }
    @keyframes aiPulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.05); } }

    /* Prospect result cards polish */
    .prospect-section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
    .prospect-section-icon { font-size: 22px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 10px; flex-shrink: 0; }
    .prospect-section-title { margin: 0; font-size: 16px; font-weight: 700; }
    .prospect-section-sub { margin: 2px 0 0; font-size: 12px; color: var(--text-secondary); }

    /* AI analysis section formatting */
    .ai-content-block { margin-bottom: 20px; }
    .ai-content-block:last-child { margin-bottom: 8px; }
    .ai-content-block h4 { margin: 0 0 8px; font-size: 14px; display: flex; align-items: center; gap: 8px; }
    .ai-content-block p, .ai-content-block ul { margin: 0; font-size: 13px; line-height: 1.7; }
    .ai-content-block ul { padding-left: 20px; }
    .ai-content-block li { margin-bottom: 4px; }

    /* Quick-stat pill row */
    .prospect-stat-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    .prospect-stat { font-size: 12px; padding: 5px 12px; border-radius: 20px; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; }

    /* Collapsible records accordion */
    .prospect-accordion { border-top: 1px solid var(--border); }
    .prospect-accordion summary {
        display: flex; align-items: center; gap: 10px; padding: 14px 0;
        font-weight: 600; font-size: 14px; cursor: pointer; list-style: none;
        color: var(--text); user-select: none;
    }
    .prospect-accordion summary::-webkit-details-marker { display: none; }
    .prospect-accordion summary::after {
        content: 'â€º'; margin-left: auto; font-size: 18px; color: var(--text-secondary);
        transition: transform 0.2s ease; font-weight: 400;
    }
    .prospect-accordion[open] summary::after { transform: rotate(90deg); }
    .prospect-accordion .accordion-body { padding-bottom: 14px; }
    .prospect-accordion .status-pill {
        font-size: 11px; padding: 2px 10px; border-radius: 10px; font-weight: 500; white-space: nowrap;
    }

    /* AI collapsible groups */
    .ai-group { margin-bottom: 8px; border-radius: 12px; }
    .ai-group summary {
        display: flex; align-items: center; gap: 8px; padding: 12px 16px;
        font-weight: 600; font-size: 14px; cursor: pointer;
        background: var(--bg-input); border-radius: 12px;
        list-style: none; color: var(--text); user-select: none;
    }
    .ai-group summary::-webkit-details-marker { display: none; }
    .ai-group summary .group-count {
        font-size: 11px; font-weight: 500; color: var(--text-secondary);
        background: var(--bg-card); padding: 1px 8px; border-radius: 8px;
    }
    .ai-group summary::after {
        content: 'â–¾'; margin-left: auto; font-size: 12px; color: var(--text-secondary);
        transition: transform 0.2s ease;
    }
    .ai-group:not([open]) summary::after { transform: rotate(-90deg); }
    .ai-group[open] summary { border-radius: 12px 12px 0 0; }
    .ai-group .ai-group-body { padding: 16px; background: var(--bg-input); border-radius: 0 0 12px 12px; }

    /* Collapsible card */
    .collapsible-card > summary {
        display: flex; align-items: center; gap: 10px; cursor: pointer;
        list-style: none; user-select: none;
    }
    .collapsible-card > summary::-webkit-details-marker { display: none; }
    .collapsible-card > summary::after {
        content: 'â€º'; margin-left: auto; font-size: 18px; color: var(--text-secondary);
        transition: transform 0.2s ease;
    }
    .collapsible-card[open] > summary::after { transform: rotate(90deg); }

    /* Print styles */
    @media print {
        /* Hide everything except the prospect results */
        body > *:not(.plugin-container),
        header, .header-top, .step-title, .progress-track,
        #prospectLoading,
        .card:has(#prospectBusinessName),
        .card:has(.btn[onclick*="exportReport"]),
        #investigationLinks,
        .logo-controls, .btn-utility, .btn-secondary,
        button, select, input,
        [onclick*="goHome"], [onclick*="toggleDarkMode"],
        .tool-back-btn, .bottom-nav,
        .dark-mode-toggle { display: none !important; }

        /* Show the results section */
        #prospectResults { display: block !important; }
        .plugin-container { padding: 0 !important; margin: 0 !important; }
        main { padding: 0 !important; }
        .card { box-shadow: none !important; border: 1px solid #ddd !important; break-inside: avoid; margin-bottom: 12px !important; page-break-inside: avoid; }

        /* Force light mode for print */
        * { color: #1a1a1e !important; background: white !important; }
        .card { background: white !important; border: 1px solid #ccc !important; }
        .prospect-stat { border: 1px solid #ccc !important; }
        .ai-content-block div[style*="background"] { background: #f5f5f5 !important; border-color: #ddd !important; }

        /* Print header */
        #prospectResults::before {
            content: 'Prospect Investigation Report';
            display: block;
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            padding: 16px 0 8px;
            border-bottom: 2px solid #333;
            margin-bottom: 20px;
        }
        #prospectResults::after {
            content: 'Generated by Altech Â· altech.agency';
            display: block;
            text-align: center;
            font-size: 10px;
            color: #999 !important;
            padding-top: 16px;
            border-top: 1px solid #ddd;
            margin-top: 16px;
        }

        /* Page setup */
        /* Force all collapsible sections open */
        details > *:not(summary) { display: block !important; }
        .prospect-accordion summary::after,
        .ai-group summary::after,
        .collapsible-card > summary::after { display: none !important; }

        @page { margin: 0.6in; size: letter; }
    }
</style>
<header>
    <div class="header-top">
        <div class="logo tool-header-brand">
            <span class="logo-controls">
                <button type="button" class="logo-icon-button" onclick="App.goHome()" aria-label="Back to home">
                    <span class="logo-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>
                </button>
                <button class="dark-mode-toggle" onclick="App.toggleDarkMode()" title="Toggle dark mode" aria-label="Toggle dark mode">
                    <span class="dark-mode-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span>
                </button>
            </span>
            <span>Prospect Investigator</span>
        </div>
        <div style="display: flex; gap: 12px; align-items: center;">
            <button class="btn-utility" onclick="ProspectInvestigator.exportReport()" style="font-size: 14px; padding: 8px 16px;">
                ï¿½ Export PDF
            </button>
        </div>
    </div>
    <div class="step-title">AI-Powered Commercial Intelligence Â· WA / OR / AZ</div>
    <div class="progress-track"><div class="progress-fill" style="width: 100%;"></div></div>
</header>

<main style="padding: 20px; padding-bottom: 60px;">

    <!-- SEARCH SECTION -->
    <div class="card">
        <h2>ğŸ” Search Business</h2>
        <p class="section-subtitle">Lookup by business name, UBI number, or contractor registration</p>

        <div class="grid-2">
            <div>
                <label class="label">Business Name</label>
                <input type="text" id="prospectBusinessName" placeholder="e.g., ABC Construction LLC">
            </div>
            <div>
                <label class="label">UBI / CCB# (Optional)</label>
                <input type="text" id="prospectUBI" placeholder="e.g., 123-456-789 or CCB#">
            </div>
        </div>

        <div class="grid-2" style="margin-top: 16px;">
            <div>
                <label class="label">City</label>
                <input type="text" id="prospectCity" placeholder="e.g., Seattle">
            </div>
            <div>
                <label class="label">State</label>
                <select id="prospectState">
                    <option value="WA">Washington</option>
                    <option value="OR">Oregon</option>
                    <option value="AZ">Arizona</option>
                </select>
            </div>
        </div>

        <button class="btn" onclick="ProspectInvestigator.search()" style="margin-top: 20px; width: 100%; background: var(--apple-blue); color: #fff; font-size: 15px; font-weight: 600; padding: 14px 18px; border-radius: 12px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <span style="font-size: 10px; width: 10px; height: 10px; background: #34C759; border-radius: 50%; display: inline-block; box-shadow: 0 0 6px rgba(52,199,89,0.6);"></span>
            Run Full Investigation
        </button>
    </div>

    <!-- LOADING INDICATOR -->
    <div id="prospectLoading" style="display: none; text-align: center; padding: 40px;">
        <div style="font-size: 48px; margin-bottom: 16px;">â³</div>
        <h3>Investigating Business Records...</h3>
        <p style="color: var(--text-secondary);">Searching WA L&I, Secretary of State, OSHA, and other public databases</p>
    </div>

    <!-- RESULTS SECTION -->
    <div id="prospectResults" style="display: none;">

        <!-- BUSINESS OVERVIEW (consolidated) -->
        <div class="card">
            <div class="prospect-section-header">
                <div class="prospect-section-icon" style="background: rgba(0,122,255,0.08);">ğŸ¢</div>
                <div>
                    <h2 class="prospect-section-title">Business Overview</h2>
                    <p class="prospect-section-sub">Consolidated profile from all data sources</p>
                </div>
            </div>
            <div id="businessSummary"></div>
        </div>

        <!-- AI ANALYSIS -->
        <div id="aiAnalysisSection" class="card" style="display: none; border: 2px solid rgba(168,85,247,0.25); background: linear-gradient(135deg, var(--bg-card), rgba(168,85,247,0.03));">
            <div class="prospect-section-header">
                <div class="prospect-section-icon" style="background: rgba(168,85,247,0.1);">ğŸ§ </div>
                <div>
                    <h2 class="prospect-section-title" style="color: #A855F7;">AI Underwriting Analysis</h2>
                    <p class="prospect-section-sub">Gemini-powered risk intelligence with web research</p>
                </div>
            </div>
            <div id="aiAnalysisContent"></div>
        </div>

        <!-- RISK CLASSIFICATION -->
        <div class="card">
            <div class="prospect-section-header">
                <div class="prospect-section-icon" style="background: rgba(0,122,255,0.08);">ğŸ“Š</div>
                <div>
                    <h2 class="prospect-section-title">Algorithmic Risk Score</h2>
                    <p class="prospect-section-sub">Data-driven risk classification from public records</p>
                </div>
            </div>
            <div id="riskClassification"></div>
        </div>

        <!-- SOURCE RECORDS (accordion) -->
        <div class="card">
            <div class="prospect-section-header">
                <div class="prospect-section-icon" style="background: rgba(255,149,0,0.08);">ğŸ“</div>
                <div>
                    <h2 class="prospect-section-title">Source Records</h2>
                    <p class="prospect-section-sub">Detailed data from each public database</p>
                </div>
            </div>

            <details class="prospect-accordion" id="liSection">
                <summary>
                    <span>ğŸ”¨ Contractor License</span>
                    <span class="status-pill" id="liStatusPill"></span>
                </summary>
                <div class="accordion-body" id="liContractorInfo"></div>
            </details>

            <details class="prospect-accordion" id="sosSection">
                <summary>
                    <span>ğŸ“‹ Business Entity</span>
                    <span class="status-pill" id="sosStatusPill"></span>
                </summary>
                <div class="accordion-body" id="sosBusinessInfo"></div>
            </details>

            <details class="prospect-accordion" id="oshaSection">
                <summary>
                    <span>âš ï¸ OSHA Inspection History</span>
                    <span class="status-pill" id="oshaStatusPill"></span>
                </summary>
                <div class="accordion-body" id="oshaViolations"></div>
            </details>

            <details class="prospect-accordion" id="googleProfileSection" style="display: none;">
                <summary>
                    <span>ğŸŒ Google Business Profile</span>
                    <span class="status-pill" id="googleStatusPill"></span>
                </summary>
                <div class="accordion-body" id="googleProfileInfo"></div>
            </details>

            <details class="prospect-accordion" id="samGovSection" style="display: none;">
                <summary>
                    <span>ğŸ›ï¸ SAM.gov Federal Registration</span>
                    <span class="status-pill" id="samStatusPill"></span>
                </summary>
                <div class="accordion-body" id="samGovInfo"></div>
            </details>
        </div>

        <!-- INVESTIGATION LINKS (collapsible) -->
        <details class="card collapsible-card">
            <summary>
                <div class="prospect-section-icon" style="background: rgba(0,122,255,0.08); flex-shrink: 0;">ğŸ”—</div>
                <div>
                    <h2 class="prospect-section-title" style="margin: 0;">Investigation Links</h2>
                    <p class="prospect-section-sub">Open official records for manual review</p>
                </div>
            </summary>
            <div id="investigationLinks" style="padding-top: 14px;"></div>
        </details>

        <!-- EXPORT ACTIONS -->
        <div class="card" style="border: 2px dashed var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                <div>
                    <h3 style="margin: 0 0 4px 0; font-size: 16px;">Export Options</h3>
                    <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Save or share this investigation report</p>
                </div>
                <div style="display: flex; gap: 12px;">
                    <button class="btn-secondary" onclick="ProspectInvestigator.copyToQuote()" style="font-size: 14px;">ğŸ“‹ Copy to Clipboard</button>
                    <button class="btn-utility" onclick="ProspectInvestigator.exportReport()" style="font-size: 14px;">ğŸ“„ Export PDF</button>
                </div>
            </div>
        </div>

    </div>

</main>
