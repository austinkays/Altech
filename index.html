<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230066cc' width='100' height='100'/><text y='70' x='50' text-anchor='middle' font-size='60' fill='white'>AL</text></svg>">
    <title>Altech Field Lead</title>
    <style>
        /* === APPLE-INSPIRED THEME === */
        :root {
            --apple-blue: #007AFF;
            --apple-blue-hover: #0051D5;
            --apple-gray: #8E8E93;
            --success: #34C759;
            --danger: #FF3B30;
            --bg: #F2F2F7;
            --bg-card: #FFFFFF;
            --bg-input: #F2F2F7;
            --text: #000000;
            --text-secondary: #8E8E93;
            --border: #E5E5EA;
            --shadow: rgba(0, 0, 0, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overscroll-behavior-y: none;
            font-weight: 400;
        }

        /* === HEADER === */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: calc(env(safe-area-inset-top) + 16px) 20px 16px;
            border-bottom: 1px solid var(--border);
            z-index: 100;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .logo { display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 22px; }
        .logo-icon { width: 40px; height: 40px; background: var(--apple-blue); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; color: white; }
        .save-indicator { font-size: 13px; color: var(--success); opacity: 0; transition: opacity 0.3s; font-weight: 500; }
        .step-title { font-size: 14px; color: var(--text-secondary); font-weight: 600; text-align: center; margin-bottom: 8px; }
        
        .progress-track { height: 3px; background: var(--border); border-radius: 1.5px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--apple-blue); width: 0%; transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

        /* === MAIN === */
        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; -webkit-overflow-scrolling: touch; }
        .hidden { display: none !important; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: 0 1px 3px var(--shadow); }
        h2 { font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--text); }
        h3 { font-size: 17px; font-weight: 600; margin: 24px 0 12px; color: var(--text); }
        .section-subtitle { font-size: 13px; color: var(--text-secondary); margin-bottom: 16px; font-weight: 400; }
        
        /* === INPUTS === */
        input, select, textarea {
            width: 100%; padding: 16px; font-size: 17px !important; 
            background: var(--bg-input); border: 1px solid var(--border); border-radius: 12px; 
            color: var(--text); margin-bottom: 12px; transition: all 0.2s;
            font-family: inherit;
        }
        input:focus, select:focus, textarea:focus { 
            outline: none; 
            border-color: var(--apple-blue); 
            background: var(--bg-card);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        .label { font-size: 13px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: block; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        
        /* === RADIO CARDS === */
        .radio-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .radio-card input { display: none; }
        .radio-card-content {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-input); padding: 20px 8px; border-radius: 14px; border: 2px solid var(--border);
            cursor: pointer; transition: all 0.2s;
            font-size: 14px; font-weight: 600; color: var(--text);
        }
        .radio-card input:checked + .radio-card-content { 
            border-color: var(--apple-blue); 
            background: rgba(0, 122, 255, 0.08);
            color: var(--apple-blue);
        }
        .radio-card-content:active { transform: scale(0.97); }

        /* === FOOTER === */
        footer {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            padding: 12px 20px calc(12px + env(safe-area-inset-bottom));
            display: flex; gap: 12px; z-index: 100;
        }
        .btn { flex: 1; padding: 16px; border-radius: 12px; font-weight: 600; font-size: 17px; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--apple-blue); color: white; box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3); }
        .btn-primary:active { background: var(--apple-blue-hover); transform: scale(0.98); }
        .btn-secondary { background: transparent; color: var(--apple-blue); border: 1px solid var(--border); }
        .btn-secondary:active { background: var(--bg-input); }
        .btn-secondary:disabled { opacity: 0.4; }

        /* === UTILS === */
        .toast {
            position: fixed; top: 100px; left: 50%; transform: translateX(-50%);
            background: var(--text); color: white; padding: 12px 24px; border-radius: 24px;
            font-weight: 600; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 200;
            font-size: 15px;
        }
        .toast.show { opacity: 1; }
        .hint { font-size: 14px; color: var(--text-secondary); background: var(--bg-input); padding: 12px 16px; border-radius: 10px; margin-bottom: 16px; line-height: 1.4; }
        .divider { height: 1px; background: var(--border); margin: 24px 0; }
    </style>
</head>
<body>

    <header>
        <div class="header-top">
            <div class="logo"><div class="logo-icon">üè†</div> Insurance Intake</div>
            <div id="saveIndicator" class="save-indicator">‚úì Saved</div>
        </div>
        <div id="stepTitle" class="step-title">Step 1 of 4: Client Information</div>
        <div class="progress-track"><div id="progressBar" class="progress-fill"></div></div>
    </header>

    <main id="mainContainer">
        <!-- STEP 1: CLIENT INFORMATION -->
        <div id="step-1" class="step">
            <div class="card">
                <h2>About You</h2>
                <p class="section-subtitle">Let's start with your basic information</p>
                
                <div class="grid-2">
                    <div><label class="label">First Name</label><input type="text" id="firstName" placeholder="John" autocomplete="given-name"></div>
                    <div><label class="label">Last Name</label><input type="text" id="lastName" placeholder="Smith" autocomplete="family-name"></div>
                </div>
                
                <label class="label">Email Address</label>
                <input type="email" id="email" placeholder="john@example.com" autocomplete="email">
                
                <div class="grid-2">
                    <div><label class="label">Phone Number</label><input type="tel" id="phone" placeholder="(555) 123-4567" autocomplete="tel"></div>
                    <div><label class="label">Date of Birth</label><input type="date" id="dob"></div>
                </div>
            </div>

            <div class="card">
                <h2>Demographics</h2>
                <p class="section-subtitle">This helps us find the best coverage options</p>
                
                <label class="label">Marital Status</label>
                <select id="maritalStatus">
                    <option value="">Select...</option>
                    <option value="Single">Single</option>
                    <option value="Married">Married</option>
                    <option value="Domestic Partner">Domestic Partner</option>
                    <option value="Widowed">Widowed</option>
                    <option value="Separated">Separated</option>
                    <option value="Divorced">Divorced</option>
                </select>
                
                <label class="label">Education Level</label>
                <select id="education">
                    <option value="">Select...</option>
                    <option value="No High School Diploma">No High School Diploma</option>
                    <option value="High School Diploma">High School Diploma</option>
                    <option value="Some College - No Degree">Some College - No Degree</option>
                    <option value="Vocational/Technical Degree">Vocational/Technical Degree</option>
                    <option value="Associates Degree">Associates Degree</option>
                    <option value="Bachelors">Bachelors</option>
                    <option value="Masters">Masters</option>
                    <option value="Phd">PhD</option>
                    <option value="Medical Degree">Medical Degree</option>
                    <option value="Law Degree">Law Degree</option>
                </select>
                
                <label class="label">Industry / Occupation</label>
                <select id="industry">
                    <option value="">Select...</option>
                    <option value="Homemaker/House person">Homemaker/House person</option>
                    <option value="Retired">Retired</option>
                    <option value="Disabled">Disabled</option>
                    <option value="Unemployed">Unemployed</option>
                    <option value="Student">Student</option>
                    <option value="Agriculture/Forestry/Fishing">Agriculture/Forestry/Fishing</option>
                    <option value="Art/Design/Media">Art/Design/Media</option>
                    <option value="Banking/Finance/Real Estate">Banking/Finance/Real Estate</option>
                    <option value="Business/Sales/Office">Business/Sales/Office</option>
                    <option value="Construction/Energy Trades">Construction/Energy Trades</option>
                    <option value="Education/Library">Education/Library</option>
                    <option value="Engineer/Architect/Science/Math">Engineer/Architect/Science/Math</option>
                    <option value="Government/Military">Government/Military</option>
                    <option value="Information Technology">Information Technology</option>
                    <option value="Insurance">Insurance</option>
                    <option value="Legal/Law Enforcement/Security">Legal/Law Enforcement/Security</option>
                    <option value="Maintenance/Repair/Housekeeping">Maintenance/Repair/Housekeeping</option>
                    <option value="Manufacturing/Production">Manufacturing/Production</option>
                    <option value="Medical/Social Services/Religion">Medical/Social Services/Religion</option>
                    <option value="Personal Care/Service">Personal Care/Service</option>
                    <option value="Restaurant/Hotel Services">Restaurant/Hotel Services</option>
                    <option value="Sports/Recreation">Sports/Recreation</option>
                    <option value="Travel/Transportation/Warehousing">Travel/Transportation/Warehousing</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="card">
                <h2>Coverage Type</h2>
                <p class="section-subtitle">What are you looking to insure?</p>
                
                <div class="radio-grid">
                    <label class="radio-card"><input type="radio" name="qType" value="home" onchange="App.handleType()">
                        <div class="radio-card-content"><span style="font-size:32px">üè†</span><span style="margin-top:8px">HOME</span></div></label>
                    <label class="radio-card"><input type="radio" name="qType" value="auto" onchange="App.handleType()">
                        <div class="radio-card-content"><span style="font-size:32px">üöó</span><span style="margin-top:8px">AUTO</span></div></label>
                    <label class="radio-card"><input type="radio" name="qType" value="both" checked onchange="App.handleType()">
                        <div class="radio-card-content"><span style="font-size:32px">üéØ</span><span style="margin-top:8px">BOTH</span></div></label>
                </div>
            </div>
        </div>

        <!-- STEP 2: PROPERTY DETAILS -->
        <div id="step-2" class="step hidden">
            <div class="card">
                <h2>Property Location</h2>
                <p class="section-subtitle">Where is the property located?</p>
                
                <label class="label">Street Address</label>
                <input type="text" id="addrStreet" placeholder="123 Main St" autocomplete="address-line1">
                
                <div class="grid-2">
                    <div><label class="label">City</label><input type="text" id="addrCity" placeholder="Vancouver"></div>
                    <div><label class="label">State</label><input type="text" id="addrState" value="WA"></div>
                </div>
                <div class="grid-2">
                    <div><label class="label">Zip Code</label><input type="tel" id="addrZip" placeholder="98686"></div>
                    <button class="btn-secondary" onclick="App.openZillow()" style="padding:14px; margin-bottom:12px">üîç View on Zillow</button>
                </div>
            </div>

            <div class="card">
                <h2>Home Basics</h2>
                <p class="section-subtitle">Tell us about your property</p>
                
                <label class="label">Dwelling Usage</label>
                <select id="dwellingUsage">
                    <option value="">Select...</option>
                    <option value="Primary">Primary</option>
                    <option value="Secondary">Secondary</option>
                    <option value="Seasonal">Seasonal</option>
                    <option value="Rental">Rental</option>
                    <option value="Vacant">Vacant</option>
                </select>
                
                <label class="label">Occupancy Type</label>
                <select id="occupancyType">
                    <option value="">Select...</option>
                    <option value="Owner Occupied">Owner Occupied</option>
                    <option value="Tenant Occupied">Tenant Occupied</option>
                </select>
                
                <label class="label">Dwelling Type</label>
                <select id="dwellingType">
                    <option value="">Select...</option>
                    <option value="Single Family">Single Family</option>
                    <option value="Condo">Condo</option>
                    <option value="Townhome">Townhome</option>
                    <option value="Row House">Row House</option>
                    <option value="Duplex">Duplex</option>
                    <option value="Triplex">Triplex</option>
                    <option value="Fourplex">Fourplex</option>
                </select>
                
                <div class="grid-2">
                    <div><label class="label">Number of Stories</label><input type="number" id="numStories" min="1" max="5" value="1"></div>
                    <div><label class="label">Full Bathrooms</label><input type="number" id="fullBaths" min="1" max="10" value="2"></div>
                </div>
                
                <div class="grid-2">
                    <div><label class="label">Square Footage</label><input type="tel" id="sqFt" placeholder="2000"></div>
                    <div><label class="label">Year Built</label><input type="tel" id="yrBuilt" placeholder="1990" oninput="App.checkUpdates()"></div>
                </div>
                
                <label class="label">Home Purchase Date</label>
                <input type="date" id="purchaseDate">
            </div>

            <div class="card">
                <h2>Construction Details</h2>
                <p class="section-subtitle">Construction and materials</p>
                
                <label class="label">Construction Style</label>
                <select id="constructionStyle">
                    <option value="">Select...</option>
                    <option value="Frame">Frame</option>
                    <option value="Masonry Veneer">Masonry Veneer</option>
                    <option value="Masonry">Masonry</option>
                    <option value="Stucco">Stucco</option>
                    <option value="Log">Log</option>
                    <option value="Adobe">Adobe</option>
                </select>
                
                <label class="label">Exterior Walls</label>
                <select id="exteriorWalls">
                    <option value="">Select...</option>
                    <option value="Vinyl Siding">Vinyl Siding</option>
                    <option value="Wood Siding">Wood Siding</option>
                    <option value="Brick">Brick</option>
                    <option value="Stucco">Stucco</option>
                    <option value="Fiber Cement">Fiber Cement</option>
                    <option value="Aluminum">Aluminum</option>
                </select>
                
                <label class="label">Foundation Type</label>
                <select id="foundation">
                    <option value="">Select...</option>
                    <option value="Slab">Slab</option>
                    <option value="Crawlspace">Crawlspace</option>
                    <option value="Basement (Finished)">Basement (Finished)</option>
                    <option value="Basement (Unfinished)">Basement (Unfinished)</option>
                    <option value="Pier/Pile">Pier/Pile</option>
                </select>
                
                <label class="label">Kitchen/Bath Quality</label>
                <select id="kitchenQuality">
                    <option value="">Select...</option>
                    <option value="Builder's Grade">Builder's Grade</option>
                    <option value="Semi-Custom">Semi-Custom</option>
                    <option value="Custom">Custom</option>
                </select>
            </div>

            <div class="card">
                <h2>Roof Information</h2>
                <p class="section-subtitle">Roof specifications</p>
                
                <div class="grid-2">
                    <div><label class="label">Roof Type</label>
                        <select id="roofType">
                            <option value="">Select...</option>
                            <option value="Asphalt/Composite Shingle">Asphalt/Composite Shingle</option>
                            <option value="Architectural Shingle">Architectural Shingle</option>
                            <option value="Metal">Metal</option>
                            <option value="Clay Tile">Clay Tile</option>
                            <option value="Concrete Tile">Concrete Tile</option>
                            <option value="Wood Shake">Wood Shake</option>
                            <option value="Slate">Slate</option>
                            <option value="Tar & Gravel">Tar & Gravel</option>
                        </select>
                    </div>
                    <div><label class="label">Roof Shape</label>
                        <select id="roofShape">
                            <option value="">Select...</option>
                            <option value="Gable">Gable</option>
                            <option value="Hip">Hip</option>
                            <option value="Flat">Flat</option>
                            <option value="Gambrel">Gambrel</option>
                        </select>
                    </div>
                </div>
                
                <label class="label">Year Roof Updated</label>
                <input type="tel" id="roofYr" placeholder="2015">
            </div>

            <div id="updatesCard" class="card hidden">
                <h2>System Updates</h2>
                <p class="section-subtitle">When were these systems last updated? (Home built before 2000)</p>
                
                <div class="grid-2">
                    <div><label class="label">Heating Updated (Year)</label><input type="tel" id="heatYr" placeholder="2010"></div>
                    <div><label class="label">Plumbing Updated (Year)</label><input type="tel" id="plumbYr" placeholder="2010"></div>
                </div>
                <label class="label">Electrical Updated (Year)</label>
                <input type="tel" id="elecYr" placeholder="2010">
            </div>

            <div class="card">
                <h2>Systems & Utilities</h2>
                <p class="section-subtitle">Heating and cooling systems</p>
                
                <label class="label">Heating Type</label>
                <select id="heatingType">
                    <option value="">Select...</option>
                    <option value="Forced Air - Gas">Forced Air - Gas</option>
                    <option value="Forced Air - Electric">Forced Air - Electric</option>
                    <option value="Heat Pump">Heat Pump</option>
                    <option value="Boiler (Steam/Water)">Boiler (Steam/Water)</option>
                    <option value="Electric Baseboard">Electric Baseboard</option>
                    <option value="Oil/Kerosene">Oil/Kerosene</option>
                </select>
                
                <label class="label">Cooling System</label>
                <select id="cooling">
                    <option value="">Select...</option>
                    <option value="Central Air">Central Air</option>
                    <option value="Window Units">Window Units</option>
                    <option value="None">None</option>
                </select>
            </div>

            <div class="card">
                <h2>Safety & Location</h2>
                <p class="section-subtitle">Fire protection and security</p>
                
                <div class="grid-3">
                    <div><label class="label">Distance to Fire Station (Miles)</label><input type="number" id="fireStationDist" step="0.1" placeholder="2.5"></div>
                    <div><label class="label">Feet to Fire Hydrant</label><input type="number" id="fireHydrantFeet" placeholder="500"></div>
                    <div><label class="label">Protection Class (1-10)</label><input type="number" id="protectionClass" min="1" max="10" placeholder="5"></div>
                </div>
                
                <label class="label">Burglar Alarm</label>
                <select id="burglarAlarm">
                    <option value="">Select...</option>
                    <option value="None">None</option>
                    <option value="Local">Local Only</option>
                    <option value="Monitored">Monitored</option>
                </select>
                
                <label class="label">Fire Alarm</label>
                <select id="fireAlarm">
                    <option value="">Select...</option>
                    <option value="None">None</option>
                    <option value="Local">Local Only</option>
                    <option value="Monitored">Monitored</option>
                </select>
                
                <label class="label">Sprinkler System</label>
                <select id="sprinklers">
                    <option value="">Select...</option>
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
            </div>
        </div>

        <!-- STEP 3: RISK & AUTO DETAILS -->
        <div id="step-3" class="step hidden">
            <div class="card">
                <h2>Liability & Risk Factors</h2>
                <p class="section-subtitle">Important underwriting information</p>
                
                <label class="label">Swimming Pool</label>
                <select id="pool">
                    <option value="">Select...</option>
                    <option value="No">No</option>
                    <option value="Yes - Fenced">Yes - Fenced</option>
                    <option value="Yes - Not Fenced">Yes - Not Fenced</option>
                </select>
                
                <label class="label">Trampoline</label>
                <select id="trampoline">
                    <option value="">Select...</option>
                    <option value="No">No</option>
                    <option value="Yes - With Net Enclosure">Yes - With Net Enclosure</option>
                    <option value="Yes - No Net">Yes - No Net</option>
                </select>
                
                <label class="label">Wood Stove</label>
                <select id="woodStove">
                    <option value="">Select...</option>
                    <option value="No">No</option>
                    <option value="Yes - Primary Heat">Yes - Primary Heat</option>
                    <option value="Yes - Secondary Heat">Yes - Secondary Heat</option>
                </select>
                
                <label class="label">Dog on Property</label>
                <input type="text" id="dogInfo" placeholder="Breed and any bite history">
                
                <label class="label">Business Operated on Property</label>
                <select id="businessOnProperty">
                    <option value="">Select...</option>
                    <option value="No">No</option>
                    <option value="Yes - Daycare">Yes - Daycare</option>
                    <option value="Yes - Inventory Storage">Yes - Inventory Storage</option>
                    <option value="Yes - Other">Yes - Other</option>
                </select>
            </div>

            <div id="autoCard" class="card">
                <h2>Auto & Driver Information</h2>
                <p class="section-subtitle">Vehicle and driving history</p>
                
                <label class="label">Driver's License Number</label>
                <div class="grid-2">
                    <input type="text" id="dlNum" style="text-transform:uppercase;font-family:monospace" placeholder="License #">
                    <input type="text" id="dlState" value="WA" placeholder="State">
                </div>
                
                <label class="label">VIN (17 Characters)</label>
                <input type="text" id="vin" maxlength="17" style="text-transform:uppercase;font-family:monospace" placeholder="1HG..." oninput="App.decodeVin(this)">
                <div id="vinResult" style="color:var(--success); font-size:13px; margin:-10px 0 16px 0; min-height:18px"></div>
                
                <label class="label">Vehicle Description</label>
                <input type="text" id="vehDesc" placeholder="Year Make Model">
                
                <div class="grid-2">
                    <div><label class="label">Primary Use</label>
                        <select id="use">
                            <option value="Commute">Commute</option>
                            <option value="Pleasure">Pleasure</option>
                            <option value="Business">Business</option>
                        </select>
                    </div>
                    <div><label class="label">Annual Mileage</label><input type="tel" id="miles" value="12000"></div>
                </div>
                
                <label class="label">Commute Distance (One Way, Miles)</label>
                <input type="number" id="commuteDist" placeholder="10">
                
                <label class="label">Ride Sharing (Uber/Lyft)</label>
                <select id="rideSharing">
                    <option value="">Select...</option>
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
                
                <label class="label">Willing to Use Telematics for Discount?</label>
                <select id="telematics">
                    <option value="">Select...</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                    <option value="Maybe">Maybe</option>
                </select>
            </div>

            <div id="autoCard2" class="card">
                <h2>Insurance History</h2>
                <p class="section-subtitle">Current and prior coverage</p>
                
                <label class="label">Current Liability Limits</label>
                <select id="liabilityLimits">
                    <option value="">Select...</option>
                    <option value="25/50">25/50</option>
                    <option value="50/100">50/100</option>
                    <option value="100/300">100/300</option>
                    <option value="250/500">250/500</option>
                    <option value="500/500">500/500</option>
                </select>
                
                <label class="label">Current Deductibles (Home / Auto)</label>
                <div class="grid-2">
                    <input type="text" id="homeDeductible" placeholder="$1000">
                    <input type="text" id="autoDeductible" placeholder="$500">
                </div>
                
                <label class="label">Prior Insurance Carrier</label>
                <input type="text" id="priorCarrier" placeholder="Current Carrier">
                
                <label class="label">Years with Prior Carrier</label>
                <input type="number" id="priorYears" placeholder="3">
                
                <label class="label">Prior Policy Expiration</label>
                <input type="date" id="priorExp">
                
                <label class="label">Accidents in Last 5 Years</label>
                <textarea id="accidents" rows="2" placeholder="Date and brief description"></textarea>
                
                <label class="label">Violations in Last 3 Years</label>
                <textarea id="violations" rows="2" placeholder="Date and type"></textarea>
                
                <label class="label">Student GPA (if driver under 25)</label>
                <input type="number" id="studentGPA" step="0.1" min="0" max="4.0" placeholder="3.5">
            </div>

            <div class="card">
                <h2>Additional Information</h2>
                <p class="section-subtitle">Final details</p>
                
                <label class="label">Mortgagee / Lender Name</label>
                <input type="text" id="mortgagee" placeholder="Bank or lender name">
                
                <label class="label">Additional Insureds (Trusts/LLCs)</label>
                <input type="text" id="additionalInsureds" placeholder="If applicable">
                
                <label class="label">Best Time to Contact</label>
                <select id="contactTime">
                    <option value="">Select...</option>
                    <option value="Morning">Morning (8am-12pm)</option>
                    <option value="Afternoon">Afternoon (12pm-5pm)</option>
                    <option value="Evening">Evening (5pm-8pm)</option>
                </select>
                
                <label class="label">How Did You Hear About Us?</label>
                <select id="referralSource">
                    <option value="">Select...</option>
                    <option value="Google Search">Google Search</option>
                    <option value="Friend/Family Referral">Friend/Family Referral</option>
                    <option value="Social Media">Social Media</option>
                    <option value="Realtor">Realtor</option>
                    <option value="Other">Other</option>
                </select>
                
                <div style="margin-top:20px; padding:16px; background:var(--bg-input); border-radius:12px;">
                    <label style="display:flex; align-items:center; font-size:15px; color:var(--text); cursor:pointer;">
                        <input type="checkbox" id="tcpaConsent" style="width:auto; margin-right:12px; margin-bottom:0;">
                        <span>I agree to receive texts and calls regarding my insurance quote</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- STEP 4: REVIEW & EXPORT -->
        <div id="step-4" class="step hidden">
            <div class="card">
                <h2>‚úì Application Complete</h2>
                <p class="section-subtitle">Choose how you'd like to export this information</p>
            </div>

            <div class="card">
                <h3>Option 1: HawkSoft Import</h3>
                <p class="section-subtitle">Includes all 30 custom fields mapped correctly</p>
                <button class="btn-primary" onclick="App.exportCMSMTF()" style="width:100%">üì• Download HawkSoft File (.cmsmtf)</button>
                <div class="hint" style="margin-top:12px">
                    Drag and drop this file directly into HawkSoft to create a new client with all custom fields populated.
                </div>
            </div>

            <div class="card">
                <h3>Option 2: EZLynx CSV Import</h3>
                <p class="section-subtitle">Standard CSV format for EZLynx Sales Center</p>
                <button class="btn-primary" onclick="App.exportCSV()" style="width:100%; background:var(--success)">üì• Download CSV File</button>
                <div class="hint" style="margin-top:12px">
                    Upload to EZLynx Sales Center to create name and address records.
                </div>
            </div>

            <div class="card">
                <h3>Option 3: EZLynx XML Import</h3>
                <p class="section-subtitle">XML format for EZLynx API integration</p>
                <button class="btn-primary" onclick="App.exportXML()" style="width:100%; background:#FF9500">üì• Download XML File</button>
                <div class="hint" style="margin-top:12px">
                    XML format compatible with EZLynx API for applicant data import.
                </div>
            </div>

            <div class="card">
                <h3>Option 4: Copy to Clipboard</h3>
                <p class="section-subtitle">For pasting into notes or remarks</p>
                <button class="btn-secondary" onclick="App.copyNotes()" style="width:100%; color:var(--apple-blue); border-color:var(--apple-blue)">
                    üìã Copy All Information
                </button>
                <div class="hint" style="margin-top:12px">
                    Copies all information in a formatted text block for pasting into notes fields.
                </div>
            </div>

            <div class="divider"></div>

            <div class="card" style="border-color:var(--danger); background:rgba(255, 59, 48, 0.05)">
                <button onclick="App.reset()" style="background:none; border:none; color:var(--danger); width:100%; font-weight:700; font-size:17px; padding:16px; cursor:pointer">
                    üóëÔ∏è Clear All Data & Start New
                </button>
            </div>
        </div>
    </main>

    <footer>
        <button id="btnBack" class="btn btn-secondary" onclick="App.prev()">Back</button>
        <button id="btnNext" class="btn btn-primary" onclick="App.next()">Next</button>
    </footer>

    <div id="toast" class="toast">Message</div>

    <script>
        const App = {
            data: {},
            step: 0,
            flow: [],
            
            workflows: {
                home: ['step-1', 'step-2', 'step-3', 'step-4'],
                auto: ['step-1', 'step-3', 'step-4'],
                both: ['step-1', 'step-2', 'step-3', 'step-4']
            },

            stepTitles: {
                'step-1': 'Step 1 of 4: Client Information',
                'step-2': 'Step 2 of 4: Property Details',
                'step-3': 'Step 3 of 4: Risk & Auto Details',
                'step-4': 'Step 4 of 4: Review & Export'
            },

            init() {
                this.load();
                this.handleType(); // Set initial flow
                
                // Auto-save listeners
                document.querySelectorAll('input, select, textarea').forEach(el => {
                    el.addEventListener('input', (e) => this.save(e));
                    el.addEventListener('change', (e) => this.save(e));
                });
                // Phone format
                document.getElementById('phone').addEventListener('input', this.fmtPhone);
            },

            handleType() {
                const t = document.querySelector('input[name="qType"]:checked').value;
                this.flow = this.workflows[t];
                
                // Show/hide auto-specific cards based on type
                const autoCards = document.querySelectorAll('#autoCard, #autoCard2');
                autoCards.forEach(card => {
                    card.style.display = (t === 'auto' || t === 'both') ? 'block' : 'none';
                });
                
                // Reset step if out of bounds
                if (this.step >= this.flow.length) this.step = 0;
                this.updateUI();
                this.save({ target: document.querySelector('input[name="qType"]:checked') });
            },

            updateUI() {
                document.querySelectorAll('.step').forEach(e => e.classList.add('hidden'));
                const curId = this.flow[this.step];
                document.getElementById(curId).classList.remove('hidden');
                
                // Update step title
                const stepTitle = document.getElementById('stepTitle');
                const totalSteps = this.flow.length;
                const currentStep = this.step + 1;
                const stepName = ['Client Information', 'Property Details', 'Risk & Auto Details', 'Review & Export'][this.flow.indexOf(curId)];
                stepTitle.textContent = `Step ${currentStep} of ${totalSteps}: ${stepName}`;
                
                // Progress
                const pct = ((this.step + 1) / this.flow.length) * 100;
                document.getElementById('progressBar').style.width = pct + '%';
                
                // Buttons
                const back = document.getElementById('btnBack');
                const next = document.getElementById('btnNext');
                back.disabled = this.step === 0;
                next.textContent = this.step === this.flow.length - 1 ? 'Finish' : 'Next';
                
                document.getElementById('mainContainer').scrollTo(0,0);
            },

            next() {
                if (this.step < this.flow.length - 1) {
                    this.step++;
                    this.updateUI();
                }
            },
            prev() {
                if (this.step > 0) {
                    this.step--;
                    this.updateUI();
                }
            },

            save(e) {
                const k = e.target.id || e.target.name;
                this.data[k] = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
                localStorage.setItem('altech_v6', JSON.stringify(this.data));
                
                const ind = document.getElementById('saveIndicator');
                ind.style.opacity = 1;
                setTimeout(() => ind.style.opacity = 0, 1500);
            },

            load() {
                const s = localStorage.getItem('altech_v6');
                if(s) {
                    this.data = JSON.parse(s);
                    Object.keys(this.data).forEach(k => {
                        const el = document.getElementById(k);
                        if(el) {
                            if(el.type === 'checkbox') {
                                el.checked = this.data[k];
                            } else {
                                el.value = this.data[k];
                            }
                        }
                        if(k === 'qType') {
                            const r = document.querySelector(`input[name="qType"][value="${this.data[k]}"]`);
                            if(r) r.checked = true;
                        }
                    });
                }
            },

            // === PROGRESSIVE DISCLOSURE ===
            checkUpdates() {
                const yrBuilt = document.getElementById('yrBuilt').value;
                const updatesCard = document.getElementById('updatesCard');
                
                if(yrBuilt && parseInt(yrBuilt) < 2000) {
                    updatesCard.classList.remove('hidden');
                } else {
                    updatesCard.classList.add('hidden');
                }
            },

            // === FEATURES ===
            async decodeVin(el) {
                const v = el.value.toUpperCase();
                if(v.length === 17) {
                    try {
                        document.getElementById('vinResult').innerText = "üîç Decoding...";
                        const r = await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvalues/${v}?format=json`);
                        const d = await r.json();
                        const r1 = d.Results[0];
                        const desc = `${r1.ModelYear} ${r1.Make} ${r1.Model}`;
                        document.getElementById('vehDesc').value = desc;
                        document.getElementById('vinResult').innerText = "‚úì " + desc;
                        this.data.vehDesc = desc; // Force save
                    } catch(e) { document.getElementById('vinResult').innerText = "‚ö†Ô∏è Decode Error"; }
                }
            },

            fmtPhone(e) {
                let x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,4})/);
                e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
            },

            openZillow() {
                const a = `${this.data.addrStreet || ''} ${this.data.addrCity || ''} ${this.data.addrState || ''} ${this.data.addrZip || ''}`;
                window.open(`https://www.zillow.com/homes/${encodeURIComponent(a)}_rb/`);
            },

            // === NOTES & EXPORT ===
            getNotes() {
                return `
=== CLIENT INFORMATION ===
Name: ${this.data.firstName || ''} ${this.data.lastName || ''}
Email: ${this.data.email || ''}
Phone: ${this.data.phone || ''}
DOB: ${this.data.dob || ''}
Marital Status: ${this.data.maritalStatus || ''}
Education: ${this.data.education || ''}
Industry: ${this.data.industry || ''}

=== PROPERTY DETAILS ===
Address: ${this.data.addrStreet || ''}, ${this.data.addrCity || ''}, ${this.data.addrState || ''} ${this.data.addrZip || ''}
Dwelling Type: ${this.data.dwellingType || ''} (${this.data.dwellingUsage || ''})
Year Built: ${this.data.yrBuilt || ''} | Square Feet: ${this.data.sqFt || ''}
Stories: ${this.data.numStories || ''} | Bathrooms: ${this.data.fullBaths || ''}
Construction: ${this.data.constructionStyle || ''} | Walls: ${this.data.exteriorWalls || ''}
Foundation: ${this.data.foundation || ''}
Roof: ${this.data.roofType || ''} (${this.data.roofShape || ''}) - Updated: ${this.data.roofYr || ''}
Heating: ${this.data.heatingType || ''} (Updated: ${this.data.heatYr || ''})
Cooling: ${this.data.cooling || ''}
Plumbing Updated: ${this.data.plumbYr || ''}
Electrical Updated: ${this.data.elecYr || ''}

=== SAFETY & SYSTEMS ===
Fire Station: ${this.data.fireStationDist || ''} miles | Hydrant: ${this.data.fireHydrantFeet || ''} feet
Protection Class: ${this.data.protectionClass || ''}
Burglar Alarm: ${this.data.burglarAlarm || ''}
Fire Alarm: ${this.data.fireAlarm || ''}
Sprinklers: ${this.data.sprinklers || ''}

=== RISK FACTORS ===
Pool: ${this.data.pool || 'No'}
Trampoline: ${this.data.trampoline || 'No'}
Wood Stove: ${this.data.woodStove || 'No'}
Dog: ${this.data.dogInfo || 'None'}
Business on Property: ${this.data.businessOnProperty || 'No'}

=== AUTO INFORMATION ===
Vehicle: ${this.data.vehDesc || ''}
VIN: ${this.data.vin || ''}
Driver's License: ${this.data.dlNum || ''} (${this.data.dlState || ''})
Usage: ${this.data.use || ''} | Annual Miles: ${this.data.miles || ''}
Commute Distance: ${this.data.commuteDist || ''} miles
Ride Sharing: ${this.data.rideSharing || 'No'}
Telematics: ${this.data.telematics || ''}

=== INSURANCE HISTORY ===
Current Liability: ${this.data.liabilityLimits || ''}
Deductibles: Home ${this.data.homeDeductible || ''} / Auto ${this.data.autoDeductible || ''}
Prior Carrier: ${this.data.priorCarrier || ''} (${this.data.priorYears || ''} years)
Prior Expiration: ${this.data.priorExp || ''}
Accidents: ${this.data.accidents || 'None'}
Violations: ${this.data.violations || 'None'}
Student GPA: ${this.data.studentGPA || 'N/A'}

=== ADDITIONAL INFO ===
Mortgagee: ${this.data.mortgagee || ''}
Additional Insureds: ${this.data.additionalInsureds || 'None'}
Purchase Date: ${this.data.purchaseDate || ''}
Kitchen/Bath Quality: ${this.data.kitchenQuality || ''}
Best Contact Time: ${this.data.contactTime || ''}
Referral Source: ${this.data.referralSource || ''}
TCPA Consent: ${this.data.tcpaConsent ? 'Yes' : 'No'}
                `.trim();
            },

            copyNotes() {
                navigator.clipboard.writeText(this.getNotes());
                this.toast('üìã Copied to Clipboard!');
            },

            exportCSV() {
                // EZLynx Specific Headers
                const h = ["First Name","Last Name","Address Line 1","City","State Code","Zip Code","Mobile Phone","Email","Date of Birth","Notes"];
                
                // Collapse notes into one line for the CSV "Notes" column
                const flatNotes = this.getNotes().replace(/\n/g, ' | ');
                
                const row = [
                    this.data.firstName, this.data.lastName, this.data.addrStreet, this.data.addrCity, this.data.addrState, this.data.addrZip,
                    this.data.phone, this.data.email, this.data.dob, flatNotes
                ].map(v => `"${v||''}"`).join(',');

                const csv = h.join(',') + "\n" + row;
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Lead_${this.data.lastName || 'Export'}.csv`;
                a.click();
                this.toast('üì• CSV Generated!');
            },

            exportXML() {
                // EZLynx XML format for applicant data
                const escapeXml = (str) => {
                    if (!str) return '';
                    return String(str)
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&apos;');
                };

                const createEntry = (key, value) => {
                    if (!value) return '';
                    return `        <DictionaryEntry>
            <Key xsi:type="xsd:string">${escapeXml(key)}</Key>
            <Value xsi:type="xsd:string">${escapeXml(value)}</Value>
        </DictionaryEntry>\n`;
                };

                // Collect notes for the Notes field
                const flatNotes = this.getNotes().replace(/\n/g, ' | ');

                let xml = `<?xml version="1.0"?>
<EventCallbackNotification xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Name>ApplicantCreated</Name>
    <Entity>Applicant</Entity>
    <EntityId>${escapeXml(this.data.lastName + '_' + Date.now())}</EntityId>
    <EventData>
`;

                // Add all available fields
                xml += createEntry('FirstName', this.data.firstName);
                xml += createEntry('LastName', this.data.lastName);
                xml += createEntry('Email', this.data.email);
                xml += createEntry('Phone', this.data.phone);
                xml += createEntry('DateOfBirth', this.data.dob);
                xml += createEntry('AddressLine1', this.data.addrStreet);
                xml += createEntry('City', this.data.addrCity);
                xml += createEntry('StateCode', this.data.addrState);
                xml += createEntry('ZipCode', this.data.addrZip);
                xml += createEntry('MaritalStatus', this.data.maritalStatus);
                xml += createEntry('Education', this.data.education);
                xml += createEntry('Industry', this.data.industry);
                
                // Property Information
                xml += createEntry('PropertyPurchaseDate', this.data.purchaseDate);
                xml += createEntry('DwellingType', this.data.dwellingType);
                xml += createEntry('DwellingUsage', this.data.dwellingUsage);
                xml += createEntry('YearBuilt', this.data.yrBuilt);
                xml += createEntry('SquareFootage', this.data.sqFt);
                xml += createEntry('NumStories', this.data.numStories);
                xml += createEntry('FullBaths', this.data.fullBaths);
                xml += createEntry('ConstructionStyle', this.data.constructionStyle);
                xml += createEntry('ExteriorWalls', this.data.exteriorWalls);
                xml += createEntry('Foundation', this.data.foundation);
                xml += createEntry('KitchenQuality', this.data.kitchenQuality);
                
                // Roof and Systems
                xml += createEntry('RoofType', this.data.roofType);
                xml += createEntry('RoofShape', this.data.roofShape);
                xml += createEntry('RoofYear', this.data.roofYr);
                xml += createEntry('HeatingType', this.data.heatingType);
                xml += createEntry('HeatingYear', this.data.heatYr);
                xml += createEntry('CoolingType', this.data.cooling);
                xml += createEntry('PlumbingYear', this.data.plumbYr);
                xml += createEntry('ElectricalYear', this.data.elecYr);
                
                // Safety and Security
                xml += createEntry('FireStationDistance', this.data.fireStationDist);
                xml += createEntry('FireHydrantDistance', this.data.fireHydrantFeet);
                xml += createEntry('ProtectionClass', this.data.protectionClass);
                xml += createEntry('BurglarAlarm', this.data.burglarAlarm);
                xml += createEntry('FireAlarm', this.data.fireAlarm);
                xml += createEntry('Sprinklers', this.data.sprinklers);
                
                // Risk Factors
                xml += createEntry('Pool', this.data.pool);
                xml += createEntry('Trampoline', this.data.trampoline);
                xml += createEntry('WoodStove', this.data.woodStove);
                xml += createEntry('DogInfo', this.data.dogInfo);
                xml += createEntry('BusinessOnProperty', this.data.businessOnProperty);
                
                // Auto and Driver Information
                xml += createEntry('DriverLicenseNumber', this.data.dlNum);
                xml += createEntry('DriverLicenseState', this.data.dlState);
                xml += createEntry('VIN', this.data.vin);
                xml += createEntry('VehicleDescription', this.data.vehDesc);
                xml += createEntry('VehicleUse', this.data.use);
                xml += createEntry('AnnualMiles', this.data.miles);
                xml += createEntry('CommuteDistance', this.data.commuteDist);
                xml += createEntry('RideSharing', this.data.rideSharing);
                xml += createEntry('Telematics', this.data.telematics);
                
                // Insurance History
                xml += createEntry('LiabilityLimits', this.data.liabilityLimits);
                xml += createEntry('HomeDeductible', this.data.homeDeductible);
                xml += createEntry('AutoDeductible', this.data.autoDeductible);
                xml += createEntry('PriorCarrier', this.data.priorCarrier);
                xml += createEntry('PriorYears', this.data.priorYears);
                xml += createEntry('PriorExpiration', this.data.priorExp);
                xml += createEntry('Accidents', this.data.accidents);
                xml += createEntry('Violations', this.data.violations);
                xml += createEntry('StudentGPA', this.data.studentGPA);
                
                // Additional Information
                xml += createEntry('Mortgagee', this.data.mortgagee);
                xml += createEntry('AdditionalInsureds', this.data.additionalInsureds);
                xml += createEntry('PreferredContactTime', this.data.contactTime);
                xml += createEntry('ReferralSource', this.data.referralSource);
                xml += createEntry('TCPAConsent', this.data.tcpaConsent ? 'Yes' : 'No');
                xml += createEntry('QuoteType', this.data.qType);
                xml += createEntry('OccupancyType', this.data.occupancyType);
                
                // Notes field with all information
                xml += createEntry('Notes', flatNotes);

                xml += `    </EventData>
</EventCallbackNotification>`;

                const blob = new Blob([xml], { type: 'application/xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Lead_${this.data.lastName || 'Export'}.xml`;
                a.click();
                this.toast('üì• XML Generated!');
            },

            exportCMSMTF() {
                // HawkSoft CMSMTF Tagged Format with Custom Fields (L1-L10, C1-C10, R1-R10)
                const fields = [
                    // Basic Info
                    { tag: 'NAM', value: `${this.data.firstName || ''} ${this.data.lastName || ''}`.trim() },
                    { tag: 'ADD', value: this.data.addrStreet },
                    { tag: 'CTY', value: this.data.addrCity },
                    { tag: 'STA', value: this.data.addrState },
                    { tag: 'ZIP', value: this.data.addrZip },
                    { tag: 'PHN', value: this.data.phone ? this.data.phone.replace(/\D/g, '') : '' },
                    { tag: 'EML', value: this.data.email },
                    { tag: 'DOB', value: this.data.dob },
                    
                    // Property & Liability (L1-L10)
                    { tag: 'L1', value: this.data.roofYr }, // Year Roof Updated
                    { tag: 'L2', value: this.data.roofType }, // Roof Material
                    { tag: 'L3', value: this.data.heatingType }, // Heating Type
                    { tag: 'L4', value: this.data.heatYr }, // Year Heating Updated
                    { tag: 'L5', value: this.data.plumbYr }, // Year Plumbing Updated
                    { tag: 'L6', value: this.data.elecYr }, // Year Electrical Updated
                    { tag: 'L7', value: this.data.pool }, // Swimming Pool
                    { tag: 'L8', value: this.data.dogInfo }, // Dog Info
                    { tag: 'L9', value: this.data.kitchenQuality }, // Kitchen/Bath Quality
                    { tag: 'L10', value: this.data.burglarAlarm }, // Security System
                    
                    // Auto & Driver Risk (C1-C10)
                    { tag: 'C1', value: this.data.liabilityLimits }, // Current Liability Limits
                    { tag: 'C2', value: this.data.priorCarrier }, // Prior Carrier Name
                    { tag: 'C3', value: this.data.priorYears }, // Years with Prior Carrier
                    { tag: 'C4', value: this.data.accidents }, // Accidents in last 5 years
                    { tag: 'C5', value: this.data.violations }, // Violations in last 3 years
                    { tag: 'C6', value: this.data.miles }, // Annual Mileage
                    { tag: 'C7', value: this.data.commuteDist }, // Commute Distance
                    { tag: 'C8', value: this.data.rideSharing }, // Ride Sharing
                    { tag: 'C9', value: this.data.telematics }, // Telematics
                    { tag: 'C10', value: this.data.studentGPA }, // Student GPA
                    
                    // Admin & Underwriting (R1-R10)
                    { tag: 'R1', value: `Home: ${this.data.homeDeductible || ''} / Auto: ${this.data.autoDeductible || ''}` }, // Current Deductibles
                    { tag: 'R2', value: this.data.trampoline }, // Trampoline
                    { tag: 'R3', value: this.data.woodStove }, // Wood Stove
                    { tag: 'R4', value: this.data.businessOnProperty }, // Business on Property
                    { tag: 'R5', value: this.data.purchaseDate }, // Home Purchase Date
                    { tag: 'R6', value: this.data.mortgagee }, // Mortgagee/Lender
                    { tag: 'R7', value: this.data.additionalInsureds }, // Additional Insureds
                    { tag: 'R8', value: this.data.contactTime }, // Best Time to Contact
                    { tag: 'R9', value: this.data.referralSource }, // Referral Source
                    { tag: 'R10', value: this.data.tcpaConsent ? 'Yes - Consented' : 'No' }, // TCPA Consent
                    
                    // Additional Property Details
                    { tag: 'DWELLING_TYPE', value: this.data.dwellingType },
                    { tag: 'DWELLING_USAGE', value: this.data.dwellingUsage },
                    { tag: 'YEAR_BUILT', value: this.data.yrBuilt },
                    { tag: 'SQ_FT', value: this.data.sqFt },
                    { tag: 'STORIES', value: this.data.numStories },
                    { tag: 'BATHROOMS', value: this.data.fullBaths },
                    { tag: 'CONSTRUCTION', value: this.data.constructionStyle },
                    { tag: 'EXTERIOR_WALLS', value: this.data.exteriorWalls },
                    { tag: 'FOUNDATION', value: this.data.foundation },
                    { tag: 'ROOF_SHAPE', value: this.data.roofShape },
                    { tag: 'COOLING', value: this.data.cooling },
                    { tag: 'FIRE_ALARM', value: this.data.fireAlarm },
                    { tag: 'SPRINKLERS', value: this.data.sprinklers },
                    { tag: 'PROTECTION_CLASS', value: this.data.protectionClass },
                    
                    // Auto Details
                    { tag: 'VIN', value: this.data.vin },
                    { tag: 'VEH', value: this.data.vehDesc },
                    { tag: 'DL_NUM', value: this.data.dlNum },
                    { tag: 'DL_STATE', value: this.data.dlState },
                    { tag: 'VEHICLE_USE', value: this.data.use },
                    
                    // Demographics
                    { tag: 'MARITAL_STATUS', value: this.data.maritalStatus },
                    { tag: 'EDUCATION', value: this.data.education },
                    { tag: 'INDUSTRY', value: this.data.industry }
                ];

                // Only include fields with data
                const content = fields
                    .filter(f => f.value && f.value.toString().trim() !== '')
                    .map(f => `[${f.tag}]${f.value}`)
                    .join('\n');

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Lead_${this.data.lastName || 'Export'}.cmsmtf`;
                a.click();
                URL.revokeObjectURL(url);
                this.toast('üì• HawkSoft File Generated!');
            },

            toast(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 2500);
            },
            
            reset() {
                if(confirm("Delete all data and start over?")) {
                    localStorage.removeItem('altech_v6');
                    location.reload();
                }
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>